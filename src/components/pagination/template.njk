{# Get page numbers #}
{% set totalPages = params.items | length %}

{% set firstPageObj = params.items | first %}
{% set lastPageObj = params.items | last %}

{% set firstPageText = firstPageObj.text %}
{% set firstPageNum = firstPageText | int %}
{% set lastPageText = lastPageObj.text %}
{% set lastPageNum = lastPageText | int %}

{# Calculate middle pages #}
{% set middlePagesEachSide = ((params.maxLength - 1) / 2) | round(0, "floor") %}

{% if (params.page - middlePagesEachSide) <= 1 %}
  {% set middlePagesStart = 1 | round(0, "floor") %}
  {% set middlePagesEnd = params.maxLength + 1 | round(0, "floor") %}
{% elif (params.page + middlePagesEachSide) >= totalPages %}
  {% set middlePagesStart = totalPages - params.maxLength + 1 | round(0, "floor") %}
  {% set middlePagesEnd = totalPages | round(0, "floor") %}
{% else %}
  {% set middlePagesStart = params.page - middlePagesEachSide | round(0, "floor") %}
  {% set middlePagesEnd = params.page + middlePagesEachSide | round(0, "floor") %}
{% endif %}

{% if params.maxLength % 2 == 0 %}
  {% set middlePagesEnd = middlePagesEnd + 1 %}
{% endif %}

{# show start truncation #}
{% if params.page > 3 %}
  {% set showTruncationStart = true %}
{% endif %}

{# show end truncation #}
{% if params.page < totalPages - 3 %}
  {% set showTruncationEnd = true %}
{% endif %}

{# show first page #}
{% if middlePagesStart !== firstPageNum and params.page > 3 %}
  {% set showFirstPage = true %}
{% endif %}

{# show last page #}
{% if middlePagesEnd !== lastPageNum and params.page < totalPages - 2 %}
  {% set showLastPage = true %}
{% endif %}

{% if totalPages !== 0 %}
  <nav class="hmrc-pagination" aria-label="{% if params.navLabel %}{{ params.navLabel | safe }}{% else %}Search results pagination{% endif %}">
    <div class="hmrc-pagination__list">

      {# Previous Button #}
      {% if params.page != 1 %}
        <span class="hmrc-pagination__item hmrc-pagination__item--prev">
          <a class="hmrc-pagination__link" href="previous">
            <span aria-hidden="true">Previous</span><span class="govuk-visually-hidden">Previous page</span>
          </a>
        </span>
      {% endif %}

      {# First page and truncation #}
      {% if showFirstPage %}
        <span class="hmrc-pagination__item">
          <a href="{{ firstPageObj.href }}" class="hmrc-pagination__link">{{ firstPageText | safe }}</a>
        </span>
      {% endif %}

      {% if showTruncationStart %}
        <span class="hmrc-pagination__item hmrc-pagination__item--dots">&hellip;</span>
      {% endif %}

      {# Main pages #}
      {% for item in params.items -%}
        {% if loop.index >= middlePagesStart and loop.index <= middlePagesEnd %}
          {% set isActiveItem = loop.index == params.page %}
          <span class="hmrc-pagination__item {% if isActiveItem %}hmrc-pagination__item--active{% endif %}" {% if isActiveItem %}aria-current="page"{% endif %}>
            <a class="hmrc-pagination__link {% if isActiveItem %}hmrc-pagination__link--active{% endif %}" href="{{ item.href | urlencode }}">{{ item.text | safe }}</a>
          </span>
        {% endif %}
      {%- endfor %}

      {# Last page and truncation #}
      {% if showTruncationEnd %}
        <span class="hmrc-pagination__item hmrc-pagination__item--dots">&hellip;</span>
      {% endif %}

      {% if showLastPage %}
        <span class="hmrc-pagination__item">
          <a href="{{ lastPageObj.href }}" class="hmrc-pagination__link govuk-link">{{ lastPageText | safe }}</a>
        </span>
      {% endif %}

      {# Next button #}
      {% if params.page != totalPages %}
        <span class="hmrc-pagination__item hmrc-pagination__item--next">
          <a class="hmrc-pagination__link govuk-link" href="next">
            <span aria-hidden="true">Next</span><span class="govuk-visually-hidden">Next page</span>
          </a>
        </span>
      {% endif %}
    </div>
  </nav>
{% endif %}
